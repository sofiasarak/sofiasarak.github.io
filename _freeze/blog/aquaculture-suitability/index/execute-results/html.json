{
  "hash": "371e1dbab64834a461ea4f528be53940",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Where Can I Farm this Marine Species?\"\ndescription: \"Building an R function to determine aquaculture suitability on the West Coast.\"\ndate: \"December 6, 2025\"\ncategories: [R, geospatial]\n---\n\nIn the growing world of aquaculture, knowing where a species will thrive is vital. The subsequent analysis aims to determine which areas of the west coast of the United States are the best suited for a variety of aquaculture species. This is done through the utilization of spatial raster and vector data as well as species-specific requirements.\n\nThe two main requirements that this analysis takes into consideration is depth and temperature (using sea surface temperature as a proxy), as many marine species can only thrive in certain conditions. Our area of interest is split into zones in order to rank which stretches of the coastline are best and worst suited to house certain species.\n\nThis sort of analysis is significant in the face of the growing global population and climate change, which has placed a strain on agriculture worldwide. Aquaculture has been growing for years, and expanding development in a thoughtful and sustainable way could contribute to more efficient food production. EXTRA SENTENCE WITH SOURCE.\n\nIn this blog post you will find an example analysis based on oysters, as well as the creation of a function that takes temperature and depth as arguments and can locate where those conditions are true.\n\n*Complete code for this analysis can be found in the corresponding [Github repository]().* \n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nlibrary(sf)\nlibrary(here)\nlibrary(tmap)\nlibrary(tidyverse)\n```\n:::\n\n\n## Data Description and Import\n\n**Sea Surface Temperature**\n\nThis analysis will use average annual sea surface temperature (SST) from the years 2008 to 2012. The data was originally generated from [NOAA’s 5km Daily Global Satellite Sea Surface Temperature Anomaly v3.1](https://coralreefwatch.noaa.gov/product/5km/index_5km_ssta.php).\n\nEach year of SST exists in its own raster file. In order to read them in at the same time, I created a for loop based on their standardized naming convention. It is also possible to simultaneously load in and stack multiple raster files using the `rast()` function, but I preferred the for loop method in my workflow!\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a vector of the years we have rasters for (what we will iterate over)\nyears <- c(2008, 2009, 2010, 2011, 2012)\n\n# Initialize empty vectors for for loop\nraster_names <- c()\nfile_paths <- c()\n\n# for loop follows the following steps:\n#   - iterates over the sequence in years vector\n#   - for each year, creates a variable name including the year\n#   - for each year, creates a file path\n#   - assigns the variable name to the raster, which is read in via the created file path\nfor (i in seq(years)){                                      \n  raster_names[i] <- paste0(\"sst_\", years[i])\n  file_paths[i] <- paste0(\"blog/aquaculture-suitability/data/average_annual_sst_\", years[i], \".tif\")\n  \n  assign(raster_names[i], rast(here(file_paths[i])))\n}\n```\n:::\n\n\n**Bathymetry**\n\nBathymetry, or ocean depth data, is provided in meters from the [General Bathymetric Chart of the Oceans (GEBCO)](https://www.gebco.net/data_and_products/gridded_bathymetry_data/#area). It exists as one raster.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Use terra package to load in raster\ndepth <- rast(here(\"blog/aquaculture-suitability/data/depth.tif\"))\n```\n:::\n\n\n**Exclusive Economic Zones**\n\nAn Exclusive Economic Zone (EEZ) is \"an area of coastal water and seabed within a certain distance of a country's coastline, to which the country claims exclusive rights for fishing, drilling, and other economic activities\" ([Oxford Languages](https://languages.oup.com/dictionaries/)).\n\nOur EEZ data is specifically for the west coast of the United States and comes from [Marineregions.org](https://www.marineregions.org/eez.php), and contains polygons delineating each of the five zones. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Use stars package to load in shape data frame\n# quiet = TRUE argument removes output/message\neez <- st_read(here(\"blog/aquaculture-suitability/data/wc_regions_clean.shp\"), quiet = TRUE)\n```\n:::\n\n\n## Preparing and Processing Data\n\nIn order to proper perform analyses using all of data sets, we need to ensure that they all have matching CRSs.\n\nFirst, we are going to stack our five SST rasters into one. As they all come from the same source and only differ in year we can reasonably assume that they all have the same CRS, but stacking would also throw an error if that was not the case.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create raster stack\nsst <- c(sst_2008, sst_2009, sst_2010, sst_2011, sst_2012)\n```\n:::\n\n\nWe can now compare our 3 data frames to see if they all have the same CRSs, and transform them to match otherwise.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Project depth raster to match CRS of sst raster\ndepth <- project(depth, crs(sst))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n```\n\n\n:::\n\n```{.r .cell-code}\n# Project (using the stars package) to match the CRS of sst raster\neez <- st_transform(eez, crs(sst))\n```\n:::\n\n\nFind mean SST over the years 2008-2012 (as our analysis will use the average temperature across 5 years).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# mean() operation on raster of multiple layers creates object with one raster layer\nmean_sst <- mean(sst)\n```\n:::\n\n\nFrom preliminary exploration, we know that SST is stored in Kelvin instead of Celsius. In order to make our results more comprehensible, we will convert our data to Celsius.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Subtract 273.15 (conversion from K to C) from all pixels\nmean_sst_c <- mean_sst - 273.15\n```\n:::\n\n\nWe want to combine our sst and depth data, but in order to do so, we have to ensure they have the same extent, resolution, and position.\n\nTo handle differences in the extent, we can crop `depth` to match `sst`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Crop depth raster to limits of sst raster\ndepth_cropped <- crop(depth, y = mean_sst_c)\n```\n:::\n\n\nAnd to fix the issue of mismatched resolutions, we can resample the depth data to match the resolution of `sst`.\n\nResampling is the method by which we can compute values for new pixel locations in `depth` based on custom resolutions and origins. We will use the \"nearest neighbor approach\", a technique in which the value of each cell in the output raster (in this case, `depth_cropped`) is calculated using the value of the nearest cell in the input raster (`mean_sst`) ([ESRI GIS Dictionary](https://support.esri.com/en-us/gis-dictionary/nearest-neighbor-resampling)). This fills in the new cells that will be created in order for `depth` to match the resolution of `sst`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Resample depth data to match specifications of sst data, specifying nearest neighbor method\ndepth_cropped_resampled <- resample(depth_cropped, y = mean_sst_c, method = \"near\")\n```\n:::\n\n\nA way to know if we have succeeded in matching the extent, resolution, and position of our two rasters is by seeing if they will stack or not. If they do not completely match, an error will be thrown and stacking will fail.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndepth_sst <- c(depth_cropped_resampled, mean_sst_c)\n```\n:::\n\n\nWe successfully stacked our two rasters!\n\n## Finding Areas with Suitable Growing Conditions: Oysters\n\n::: {#fig-oyster .figure fig-cap=\"Image Source: [Pangea Shellfish Company](https://www.pangeashellfish.com/blog/the-different-methods-of-growing-oysters)\" fig-align=\"center\"}\n![](images/oysters.jpeg)\n:::\n\nResearch has shown that oysters need the following conditions for optimal growth:\n\n-   depth: 0-70 meters below sea level (or -70 in our data)\n-   sea surface temperature: 11-30°C\n\nThese specifications come from the [EDS223 assignment description](https://eds-223-geospatial.github.io/assignments/HW4.html#fn3), but can also be retrieved from resources such as [SeaLifeBase](https://www.sealifebase.ca/search.php).\n\nIn order to find the areas with suitable growing conditions for oysters, we will assign a value of 1 to each pixel that is within the suitable range and 0 otherwise, for both of our separate raster layers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Change layer names to be more indicative (\"mean\" --> \"sst_mean\")\nnames(depth_sst) <- c(\"depth\", \"sst_mean_c\")\n\n# Create copy of data frame to serve as mask\ndepth_sst_mask <- depth_sst\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create suitability matrix based on min and max sst \nsst_suitability <- matrix(c(-Inf, 11, 0,  # Will return 0 for values (-Inf, 11)\n                          11, 30, 1,      # Will return 1 for values (11, 30)\n                          30, Inf, 0),    # Will return 0 for values (30, Inf)\n                          nrow = 3, byrow = TRUE)\n\n# Classify sst layers using matrix\ndepth_sst_mask[[\"sst_mean_c\"]] <- classify(depth_sst_mask[[\"sst_mean_c\"]], rcl = sst_suitability)\n\n# Create suitability matrix based on min and max sst \ndepth_suitability <- matrix(c(-Inf, -70, 0,\n                              -70, 0, 1,\n                              0, Inf, 0),\n                            nrow = 3, byrow = TRUE)\n\n# Classify depth layers using matrix\ndepth_sst_mask[[\"depth\"]] <- classify(depth_sst_mask[[\"depth\"]], rcl = depth_suitability)\n```\n:::\n\n\nTo create one suitability layer that contains suitability based on *both* variables, we will multiply the two layers, obtaining the following results:\n\n-   if a cell = 1, it is suitable based on both conditions\n-   if a cell = 0, it is not suitable (either based on one of or both conditions)\n\nThis can be true because anything multiplied by 0 (not suitable in this case), will equal 0. If at least one of our layers contains 0, our new suitability layer will also contain the value 0. Cells that are suitable for both SST and depth will be the only ones that contain 1 as their value.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Multiple two layers and save as a new raster\noyster_suitability <- depth_sst_mask[[\"depth\"]] * depth_sst_mask[[\"sst_mean_c\"]]\n\n# Rename raster layer to be more indicative (\"depth\" --> \"suitable\")\nnames(oyster_suitability) <- c(\"suitable\")\n```\n:::\n\n\n## Determining the Most Suitable EEZ\n\nWe want to determine the total suitable area within each EEZ in order to rank zones by priority.\n\nThis requires three distinct steps:\n\n1.  Find the number of cells within each zone that are deemed suitable (based on previous analysis).\n\n2.  Find the physical area that each cell represents (in km\\^2).\n\n3.  Multiply number of cells by area that cells represent to get actual suitable area, by zone.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a raster of species suitability only within the EEZ boundaries\nsuitable_westcoast <- mask(oyster_suitability, eez)\n\n# Rasterize EEZ (will allow for zonal operations)\neez_rast <- rasterize(eez, suitable_westcoast,\n                      field = \"rgn\")      # Set region as the value we want populating the EEZ raster\n```\n:::\n\n\nWe can find the number of suitable *cells* in each EEZ region by using the `terra::zonal` function. It summarizes values of one SpatRaster based on the zones provided by another. In our case, we will be summing the values of our suitable cells grouped by EEZ.\n\nSummation works to provide the number of suitable cells in this case because we had populated suitable with \"1\"s and unsuitable with \"0\"s.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find the number of suitable cells per EEZ region\nsuitable_per_region <- zonal(suitable_westcoast, eez_rast, fun = \"sum\", na.rm = TRUE)\n```\n:::\n\n\n**Results:**\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|EEZ Region          | # of Suitable Cells|\n|:-------------------|-------------------:|\n|Central California  |                 238|\n|Northern California |                  11|\n|Oregon              |                  71|\n|Southern California |                 211|\n|Washington          |                 162|\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\nFind area of each cell in square km by extracting cell size information.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# cellSize() returns a SpatRaster object of information, we want to extract just cell area\ncell_area <- cellSize(suitable_westcoast, unit=\"km\")[1]\n```\n:::\n\n\nMultiply the cell area by number of cells to get total area.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Multiply by each region by adding and specifying columns to data frame\nsuitable_per_region <- suitable_per_region %>% \n  mutate(cell_area = cell_area,\n         area_suitable = suitable * cell_area) %>% \n  relocate(cell_area, .after = suitable) \n```\n:::\n\n\nIn order to produce a map of West Coast EEZs colored by amount of suitable species area in each region, we need to join our EEZ geometries to our `suitable_per_region` data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Join EEZ data frame (with geometries) to data frame with suitable area by region\neez_suitability_geom <- left_join(eez, suitable_per_region, by = \"rgn\")\n```\n:::\n\n\nThe `eez_suitability_geom` now contains the five West Coast region polygons with their corresponding suitable areas for oysters.\n\nThe final step of our oyster analysis is to create a map of EEZ regions colored by amount of suitable area. For this, we use our original depth raster to provide a background image (and general outlines of the California coast), overlayed with the 5 West Coast EEZs, colored by amount of suitable area.\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nFrom this visualization, we can see that -- based on suitable depth and sst -- Central and Southern California are the best suited for oyster aquaculture compared to the other EEZs of the US West Coast.\n\n## Generalizing Workflow (Creating Function)\n\nIn the code above, we developed a method of extracting the most suitable regions for marine aquaculture based on just a few parameters: temperature range and depth range. By making our workflow generalizable, we can create a function that takes a handle of arguments and produces a map of suitable West Coast EEZs for any marine species.\n\nOur function will assume that the datasets/rasters `sst` (single layer), `depth`, and `eez` are pre-loaded and contain the correct attributes.\n\nThe other thing to note is that when inputting minimum and maximum depth, we will input the absolute value of depth (so, no negatives), with the larger number being maximum depth. For example, a depth of 70 meters, or 70 meters below sea level, should be entered as 70.\n\nThis blog post won't include the entirety of the code used in the function because it nearly perfectly mimics the analysis done on oysters. However, a quick summary is included here:\n\n**Function Structure**\n\n::: {.cell execute='false'}\n\n```{.r .cell-code}\n# Initialize function\nwest_coast_suitability_map <- function(species, min_sst, max_sst, min_depth, max_depth){\n  \n# 1. Create depth and temperature suitability masks based on inputs\n  \n# 2. Multiply masks to get overall species suitability \n  \n# 3. Rasterize eez and perform zonal operation to find total suitable area in each zone\n  \n# 4. Join eez geometries to data frame with suitable area by region\n\n# 5. Plot!\n}\n```\n:::\n\n\n\n\n::: {.cell}\n\n:::\n\n\n## Running Function on New Species: Bull Kelp\n\n\n![](images/bull_kelp.jpg){fig-align=\"center\" fig-cap=\"Image Source: [aquaculturenorthamerica.com](https://www.aquaculturenorthamerica.com/alaskas-vast-mariculture-potential/)\"}\n\nImage Source: [aquaculturenorthamerica.com](https://www.aquaculturenorthamerica.com/alaskas-vast-mariculture-potential/)\n\nBull kelp farming is a niche sector of seaweed aquaculture, especially small compared to the large seaweed operations taking place in Asia. Currently, there are only a few active, albeit experimental, bull kelp farms in Alaska and BC.\n\nThis lack of development is partially due to the fact that bull kelp is not necessarily a commercial commodity in the same way other species of seaweed, such as sugar kelp (Sacharrina latissima) or ribbon kelp (Alaria marginata), are. Despite its challenges, bull kelp is essential for ocean health and biodiversity, so farming more of it could help with restoration efforts, as well as help fill knowledge gaps in its cultivation.\n\nBull kelp's suitability conditions are as follows:\n\n-   depth: 17 to 40 meters\n-   sea surface temperature: 10 to 16 degrees Celsius\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Use function to plot regions with highest suitability\nwest_coast_suitability_map(species = \"Bull Kelp\" ,\n                           min_sst = 10,\n                           max_sst = 16,\n                           min_depth = 40,\n                           max_depth = 17)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-24-1.png){fig-align='center' width=672}\n:::\n:::\n\n\nFrom this visualization, we can see that -- based on suitable depth and sea surface temperature -- the Washington region is by far the best suited for bull kelp aquaculture compared to the other EEZs of the US West Coast. This agrees with our previous research: if successful bull kelp farms are mostly in Alaska and Canada, it would make sense that the northernmost region would be the most suitable.\n\n## Conclusion\n\nThis blog post used packages such as `terra` and `sf` to combine raster and vector data on ocean depth and temperature, and classify different zones along the cost based on specifications. In our case, we were able to determine that the southern California coast is the most suitable for oyster aquaculture whereas the northern coast -- specifically the Washington EEZ -- is best for bull kelp. \n\nIt is important to note, however, that sea surface temperature and depth are only two of the many factors that influence aquaculture success. Our analysis not only excludes other variables such as current strength, salinity, and water quality, but also fails to consider future changes to ocean temperature that may be crucial in the planning of aquaculture.\n\nDespite these caveats, this sort of code is generalizable first step to a variety of uses that involve finding most suitable areas -- not just for aquaculture. And especially with the creation of a function, the possibilities are endless.\n\n## References\n\n[CA.gov Marine Species Portal](https://marinespecies.wildlife.ca.gov/kelp/true/#:~:text=Bull%20kelp%20grows%20on%20similar,and%20on%20wave%2Dexposed%20reefs.)\n\n[bullkelp.info](https://bullkelp.info/aquaculture)\n\nWeigel, B. L., Small, S. L., Berry, H. D., & Dethier, M. N. (2023). Effects of temperature and nutrients on microscopic stages of the bull kelp (Nereocystis luetkeana, Phaeophyceae). Journal of phycology, 59(5), 893–907. https://doi.org/10.1111/jpy.13366\n\n\nTo do w internet:\n- fix references\n- try to get rid of that loading line when transforming crs\n- how to get rid of \"figure 1\" under image caption?\n- space after kable?\n- get fig-align help?\n- add github link\n- add extra resource ",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}